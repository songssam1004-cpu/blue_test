<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>교직원 수첩 프로토타입</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        /* [기본 스타일 - 원본 CSS가 없으므로 기능 확인을 위해 임의 작성] */
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; min-height: 100vh; }
        [v-cloak] { display: none; }
        ul, li { list-style: none; padding: 0; margin: 0; }
        a { text-decoration: none; color: inherit; }
        
        /* 탭 스타일 */
        .tab_wrap { display: flex; border-bottom: 2px solid #ddd; }
        .tab_wrap li { flex: 1; text-align: center; padding: 15px 0; cursor: pointer; background: #eee; }
        .tab_wrap li.on { background: #fff; font-weight: bold; border-bottom: 2px solid #0055a5; color: #0055a5; }
        .cont-tabbox { display: none; padding: 20px; }
        .cont-tabbox.on { display: block; }

        /* 검색 폼 스타일 */
        .search_form { background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .search_form dl { display: flex; margin-bottom: 10px; align-items: center; }
        .search_form dt { width: 80px; font-weight: bold; }
        .search_form dd { flex: 1; display: flex; gap: 5px; }
        .srch_input_box { flex: 1; display: flex; }
        .srch_input_box input, .srch_input_box select { width: 100%; padding: 8px; border: 1px solid #ccc; }
        .search_btn, .reset_btn { padding: 8px 15px; background: #333; color: #fff; border-radius: 4px; font-size: 13px; }

        /* 조직도 트리 스타일 */
        .tree-node { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; position: relative; }
        .tree-node:hover { background-color: #f0f8ff; }
        .tree-node::before { content: '▶'; display: inline-block; margin-right: 5px; font-size: 0.8em; transition: transform 0.2s; }
        .tree-node.active::before { transform: rotate(90deg); }
        .tree-node.no_depth::before { content: '•'; transform: none; color: #ccc; }
        
        /* 뎁스별 들여쓰기 */
        .depth1 { padding-left: 10px; font-weight: bold; background: #fafafa; }
        .depth2 { padding-left: 30px; }
        .depth3 { padding-left: 50px; }

        /* 직원 카드 스타일 */
        .staff_cont { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; background: #fff; }
        .staff_cont .top { display: flex; gap: 15px; margin-bottom: 10px; }
        .staff_cont img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background: #eee; }
        .staff_cont .name { font-size: 1.1em; margin-bottom: 5px; }
        .staff_cont .s_info { font-size: 0.9em; color: #666; margin-top: 5px; }
        .staff_cont .bottom { background: #f8f8f8; padding: 10px; border-radius: 5px; font-size: 0.9em; }
        .staff_cont dl { display: flex; margin: 3px 0; }
        .staff_cont dt { width: 80px; color: #888; }
        .major_view { display: block; margin-top: 10px; padding: 8px; background: #eef4fb; color: #0055a5; text-align: center; border-radius: 4px; font-size: 0.9em; }

        /* 모달 스타일 */
        .modal_box { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: flex; justify-content: center; align-items: center; }
        .modal_box .cont { background: #fff; padding: 25px; width: 300px; border-radius: 10px; }
        .modal_box h3 { margin-top: 0; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .modal_box dl { margin: 15px 0; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .modal_box dt { color: #0055a5; font-weight: bold; margin-bottom: 5px; }
        .modal_box .btn_wrap { margin-top: 20px; text-align: center; }
        .modal_box .btn_wrap a { padding: 10px 30px; background: #0055a5; color: #fff; border-radius: 20px; }

        .hidden { overflow: hidden; }
        .all_btn_wrap { padding: 10px; text-align: right; }
        .all_btn_wrap span { cursor: pointer; margin-left: 10px; font-size: 0.9em; color: #555; border: 1px solid #ddd; padding: 2px 8px; }
        
        /* 색인 스타일 */
        .index_wrap { display: flex; overflow-x: auto; gap: 5px; padding: 10px; background: #fff; border-bottom: 1px solid #eee; }
        .index_wrap span { flex: 0 0 auto; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: 1px solid #ddd; border-radius: 50%; cursor: pointer; }
        .index_wrap span.on { background: #0055a5; color: #fff; border-color: #0055a5; }
    </style>
</head>
<body>

<script>
    // 1. 유틸리티 Mocking
    var util = {
        maks: function(val, type) {
            if (!val) return "";
            if (type === 'EMAIL') {
                return val.replace(/(.{2})(.*)(@.*)/, "$1****$3");
            }
            return val;
        }
    };

    // 2. 통신 모듈 Mocking (comm.post)
    var comm = {
        post: function(options, callback) {
            console.log("[Mock API Call]", options.url, options.params);
            
            // 네트워크 지연 시뮬레이션
            setTimeout(function() {
                var response = { list: [], status: "success" };

                // URL별 가짜 데이터 반환
                if (options.url.includes("getOrgChartDeptList.do")) {
                    response.list = {
                        list: [
                            { 
                                deptNm: "대학본부", deptCd: "10000", 
                                children: [
                                    { deptNm: "교무처", deptCd: "11000", children: [], members: [] },
                                    { deptNm: "학생처", deptCd: "12000", children: [], members: [] }
                                ],
                                members: []
                            },
                            { 
                                deptNm: "공과대학", deptCd: "20000", 
                                children: [
                                    { deptNm: "전자전기컴퓨터공학부", deptCd: "21000", children: [], members: [] },
                                    { deptNm: "기계공학과", deptCd: "22000", children: [], members: [] }
                                ],
                                members: []
                            }
                        ]
                    };
                } 
                else if (options.url.includes("fetchMembers.do")) {
                    // 랜덤 멤버 생성
                    response.list = [
                        { constntNm: "홍길동", jbttlCdNm: "교수", userDivcdNm: "교원", deptNm: "컴퓨터공학부", email: "hong@univ.ac.kr", cryalTelNo: "010-1234-5678", premisTelno: "1234", laboratory: "제1공학관 301호", srngDetailMjrNm: "인공지능", staffBirthYn: "Y", selfBrdt: "19800101" },
                        { constntNm: "김철수", jbttlCdNm: "팀장", userDivcdNm: "직원", deptNm: "교무과", email: "kim@univ.ac.kr", cryalTelNo: "010-9876-5432", premisTelno: "5678", laboratory: "본관 101호", taskFldNm: "학적 관리", staffBirthYn: "N", selfBrdt: "19850505" }
                    ];
                }
                else if (options.url.includes("getPresidentInfo.do")) {
                    response.info = { constntNm: "이총장", jbttlCdNm: "총장", userDivcdNm: "교원", deptNm: "총장실", email: "president@univ.ac.kr", cryalTelNo: "010-0000-0000", premisTelno: "0001", laboratory: "본관 2층", srngDetailMjrNm: "대학행정" };
                }
                else if (options.url.includes("searchStaffList.do") || options.url.includes("searchDetailStaffList2.do")) {
                     response.list = [
                        { constntNm: "검색된_홍길동", jbttlCdNm: "부교수", userDivcdNm: "교원", deptNm: "전자공학과", email: "search@univ.ac.kr", cryalTelNo: "010-1111-2222", premisTelno: "3333", laboratory: "제2공학관", srngDetailMjrNm: "반도체", staffBirthYn: "Y", selfBrdt: "19751212" }
                    ];
                }
                else if (options.url.includes("getOneDeptList.do")) {
                    response.list = [{deptCd: 'D01', deptNm: '공과대학'}, {deptCd: 'D02', deptNm: '인문대학'}];
                }
                else if (options.url.includes("getDeptList.do")) {
                    response.list = [{deptCd: 'D01-01', deptNm: '컴퓨터과학부'}, {deptCd: 'D01-02', deptNm: '신소재공학과'}];
                }
                else if (options.url.includes("getIndexList.do")) {
                    response.list = [
                        { constntNm: "강감찬", deptNm: "역사학과", constntNo: "1" },
                        { constntNm: "고길동", deptNm: "만화창작과", constntNo: "2" }
                    ];
                }

                callback(response);
            }, 100);
        }
    };

    // 3. JSP 파라미터 맵 Mocking
    var paramMap = {
        session: { menuGrpId: 'CCMN000.930' },
        multiLanguage: 'KOR'
    };
    
    // 4. 기타 전역 함수
    function goOpenBrowser(url) {
        alert("새 브라우저 열기: " + url);
    }
</script>

<div id="container" class="container">
    <div id="content" v-cloak class="staffnote">
        
        <ul class="tab_wrap tab-script">
            <li v-for="(tab, index) in tabs" :key="index" :class="{ 'on': activeTabIndex === index }">
                <a href="#" @click.prevent="setActiveTab(index)">
                    <span v-if="language == 'ENG'">{{ tab.enName }}</span>
                    <span v-else>{{ tab.name }}</span>
                </a>
            </li>
        </ul>
    
        <div class="cont-tabwrap">
            <div class="cont-tabbox" :class="{ 'on': activeTabIndex === 0 }">
                <div class="search_form_wrap">
                    <div class="sticky_wrap">
                        <div class="top_bn_btn" @click="goProfileConfig()" style="text-align: right; padding: 10px; cursor: pointer; color: #666; font-size: 0.8em;">
                            <p>교직원수첩 공개정보 수정 ></p>
                        </div>
                    </div>
                </div>
                <div class="inner org_chart">
                    <div class="top_depth" style="padding:15px; font-weight:bold; font-size:1.2em;">
                        서울시립대학교
                    </div>
                   <div class="all_btn_wrap">
                        <ul>
                            <li class="all_close" @click="closeAllNodes()"><span>전체닫기</span></li>
                            <li class="all_open" @click="openAllNodes()"><span>전체열기</span></li>
                        </ul>
                    </div>
                    
                    <ul v-show="orgDeptList">
                        <li class="president-node">
                            <div class="tree-node depth1" :class="{ active: isActiveNode('00000') }" @click="toggleNode('00000')">
                                총장
                            </div>
                            <ul v-if="president" v-show="isActiveNode('00000')" class="list_wrap box sty2">
                                <li class="staff_cont">
                                    <div class="top">
                                        <p><img src="https://via.placeholder.com/60" alt="프로필"></p>
                                        <div>
                                            <div class="name"><strong>{{president.constntNm}}</strong></div>
                                            <span>{{president.jbttlCdNm}} · {{president.deptNm}}</span>
                                        </div>
                                    </div>
                                    <div class="bottom">
                                        <dl><dt>사무실</dt><dd>{{president.laboratory}}</dd></dl>
                                        <dl><dt>이메일</dt><dd>{{president.email}} <button @click="copyEmail(president.email)">복사</button></dd></dl>
                                    </div>
                                </li>
                            </ul>
                        </li>

                        <li v-for="node in orgDeptList" :key="node.deptCd">
                            <div class="tree-node depth1" :class="{ active: isActiveNode(node.deptCd), 'no_depth' : (!node.children || !node.children.length) && (!node.members || !node.members.length) }" @click="toggleNode(node.deptCd)">
                                {{ node.deptNm }}
                            </div>

                            <ul v-show="isActiveNode(node.deptCd)">
                                <li v-show="node.members && node.members.length">
                                    <ul class="list_wrap box sty2">
                                        <li v-for="(member, idx) in node.members" :key="'m1-'+idx" class="staff_cont">
                                            <div class="top">
                                                <p><img src="https://via.placeholder.com/60" alt="프로필"></p>
                                                <div>
                                                    <div class="name"><strong>{{member.constntNm}}</strong></div>
                                                    <span>{{member.jbttlCdNm}} · {{member.deptNm}}</span>
                                                </div>
                                            </div>
                                            <div class="bottom">
                                                <dl><dt>연락처</dt><dd>{{member.premisTelno}}</dd></dl>
                                                <dl><dt>이메일</dt><dd>{{member.email}}</dd></dl>
                                            </div>
                                            <a href="#" class="major_view" @click="majorPopModal(member)">상세보기</a>
                                        </li>
                                    </ul>
                                </li>
                                <li v-for="child in node.children" :key="child.deptCd">
                                    <div class="tree-node depth2" :class="{ active: isActiveNode(child.deptCd), 'no_depth' : !child.children.length && (!child.members || !child.members.length) }" @click="toggleNode(child.deptCd)">
                                        {{ child.deptNm }}
                                    </div>
                                    <ul v-show="isActiveNode(child.deptCd)">
                                        <li v-show="child.members && child.members.length">
                                            <ul class="list_wrap box sty2">
                                                <li v-for="(member, idx) in child.members" :key="'m2-'+idx" class="staff_cont">
                                                    <div class="top">
                                                        <p><img src="https://via.placeholder.com/60" alt="프로필"></p>
                                                        <div>
                                                            <div class="name"><strong>{{member.constntNm}}</strong></div>
                                                            <span>{{member.jbttlCdNm}} · {{member.deptNm}}</span>
                                                        </div>
                                                    </div>
                                                    <a href="#" class="major_view" @click="majorPopModal(member)">상세보기</a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="cont-tabbox" :class="{ 'on': activeTabIndex === 1 }">
                <div class="search_form">
                     <dl>
                        <dt>대학/처</dt>
                        <dd>
                            <div class="srch_input_box">
                                <select v-model="oneDept" @change="getDeptList('4',$event.target.value)">
                                    <option value="">전체</option>
                                    <option v-for="od in oneDeptList" :value="od.deptCd">{{od.deptNm}}</option>
                                </select>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>부서</dt>
                        <dd>
                            <div class="srch_input_box">
                                <select v-model="twoDept">
                                    <option value="">전체</option>
                                    <option v-for="td in twoDeptList" :value="td.deptCd">{{td.deptNm}}</option>
                                </select>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>성명</dt>
                        <dd>
                            <div class="srch_input_box">
                                <input type="text" v-model="constntNm" placeholder="이름 입력"/>
                            </div>
                            <a href="#" class="search_btn" @click="searchDetailPosition()">검색</a>
                        </dd>
                    </dl>
                </div>
                
                <div class="inner">
                     <ul class="list_wrap box sty2" v-show="positionList && positionList.length > 0">
                        <li v-for="sList in positionList" class="staff_cont">
                             <div class="top">
                                <p><img src="https://via.placeholder.com/60" alt=""></p>
                                <div>
                                    <div class="name"><strong>{{sList.constntNm}}</strong></div>
                                    <span>{{sList.jbttlCdNm}}</span>
                                </div>
                            </div>
                        </li>
                     </ul>
                     <div v-show="!positionList || positionList.length == 0" style="text-align:center; padding:20px;">
                        검색 결과가 없습니다.
                     </div>
                </div>
            </div>

            <div class="cont-tabbox" :class="{ 'on': activeTabIndex === 2 }">
                <div class="search_form">
                    <dl>
                         <dd class="no_dt">
                            <div class="srch_input_box">
                                <select v-model="searchType" style="width:80px; margin-right:5px;">
                                    <option value="">전체</option>
                                    <option v-for="ss in searchSelect" :value="ss.type">{{ss.typeNm}}</option>
                                </select>
                                <input type="text" v-model="constntNm" placeholder="검색어를 입력하세요."/>
                            </div>
                            <a href="#" class="reset_btn" @click="reset()">초기화</a>
                            <a href="#" class="search_btn" @click="searchDetail()">검색</a>
                        </dd>
                    </dl>
                </div>
                <div class="inner">
                     <ul class="list_wrap box sty2" v-show="staffList && staffList.length > 0">
                        <li v-for="sList in staffList" class="staff_cont">
                             <div class="top">
                                <p><img src="https://via.placeholder.com/60" alt=""></p>
                                <div>
                                    <div class="name"><strong>{{sList.constntNm}}</strong></div>
                                    <span>{{sList.jbttlCdNm}}</span>
                                </div>
                            </div>
                            <a href="#" class="major_view" @click="majorPopModal(sList)">상세보기</a>
                        </li>
                     </ul>
                </div>
            </div>

            <div class="cont-tabbox index" :class="{ 'on': activeTabIndex === 3 }">
                 <div class="index_wrap">
                    <span v-for="(item, index) in indexItem" :key="index" :class="{ on: index === selectedIndex }" @click="getIndexList(index)">
                        {{ item.word }}
                    </span>
                </div>
                <div class="inner">
                    <ul class="list_wrap box sty1" v-show="indexList && indexList.length > 0">
                        <li v-for="iList in indexList" @click="searchIndex(iList.constntNo)" style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;">
                             <p><strong>{{iList.constntNm}}</strong> <span style="font-size:0.8em; color:#666;">{{iList.deptNm}}</span></p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="modal_box" id="major_view" v-show="isMajorViewVisible">
            <div class="cont">
                <dl>
                    <h3>{{popModalDetailNm}}</h3>
                </dl>
                <dl>
                    <dt>소속</dt>
                    <dd>{{popModalDetailPosi}} · {{popModalDetailDept}}</dd>
                </dl>
                <dl>
                    <dt>{{srngDetailMjrTitle}}</dt>
                    <dd>{{srngDetailMjrNm}}</dd>
                </dl>
                <div class="btn_wrap">
                    <a href="#" class="col01" @click="majorPopModal()">확인</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var documentReady = function () {
        var vm = new Vue({
            el: '#content',
            data: function () {
                return {
                    activeTabIndex: 0, 
                    tabs: [ 
                        { name: '조직도' , enName: 'Organization' },
                        { name: '보직자 조회' , enName: 'Positions'},
                        { name: '상세검색' , enName: 'Search'},
                        { name: '색인' , enName: 'Index'},
                    ],
                    isMajorViewVisible : false ,
                    srngDetailMjrTitle : '',
                    srngDetailMjrNm : '',
                    popModalDetailNm : '',
                    popModalDetailPosi : '',
                    popModalDetailDept : '',
                    searchSelect: [{'type':'1', 'typeNm':'조직명'}, {'type':'2', 'typeNm':'성명'}],
                    searchType : '',
                    constntNo : '',
                    constntNm : '',
                    ogdpDeptCd: '',
                    selectDeptNm : '',
                    orgDeptList : [],
                    positionList : [],
                    staffList : [],
                    searchPerformed : false,
                    selectedIndex: 0,
                    indexItem : [
                        {num : 0, word : 'ㄱ'}, {num : 2, word : 'ㄴ'},
                        {num : 3, word : 'ㄷ'}, {num : 5, word : 'ㄹ'},
                        {num : 6, word : 'ㅁ'}, {num : 7, word : 'ㅂ'},
                        {num : 9, word : 'ㅅ'}, {num : 11, word : 'ㅇ'},
                        {num : 12, word : 'ㅈ'}, {num : 14, word : 'ㅊ'},
                        {num : 15, word : 'ㅋ'}, {num : 16, word : 'ㅌ'},
                        {num : 18, word : 'ㅎ'}, {num : 99, word : 'A-Z'}
                    ],
                    indexList : [],
                    oneDept : '',
                    twoDept : '',
                    thrDept : '',
                    oneDeptList : [],
                    twoDeptList : [],
                    thrDeptList : [],
                    activeNodes: {},
                    language : 'KOR', // Mock Default
                    pageInfo: { pageNo: 1, pageSize: 10, totalCount: 0 },
                    wiseMenuId : '',
                    menuGrpId: '',
                    president : {}
                };
            },
            created: function () {
                var vm = this;
                vm.initOrgChartDeptList();
                vm.getOneDeptList();
                vm.getIndexList(0);
                vm.getPresidentInfo('00000');
                vm.menuGrpId = 'CCMN000.930'; // Mock data
            },
            methods: {
                initOrgChartDeptList : function (){
                    var vm = this;
                    comm.post({
                        url: "./getOrgChartDeptList.do",
                        params: { 'upDeptCd' : '00001' }
                    }, function (data) {
                        vm.orgDeptList = data.list.list;
                        // 초기 로딩 시 데이터 있으면 펼침 처리를 위해 1뎁스 열기 (옵션)
                        if(vm.orgDeptList && vm.orgDeptList.length > 0){
                            vm.$set(vm.activeNodes, vm.orgDeptList[0].deptCd, true);
                        }
                    });
                },
                reset: function () {
                    var vm = this;
                    vm.constntNm = '';
                    vm.ogdpDeptCd = '';
                    vm.selectDeptNm = '';
                    vm.oneDept = '';
                    vm.twoDept = '';
                    vm.twoDeptList = [];
                    vm.staffList = [];
                    vm.positionList = [];
                },
                searchDetailPosition : function () {
                    // 프로토타입용 단순 검색
                    var vm = this;
                    comm.post({
                        url: "./searchDetailPositionList.do", // Mocked URL
                        params: { 'constntNm' : vm.constntNm }
                    }, function (data) {
                        vm.positionList = data.list; // Mocked data uses 'searchStaffList' result structure usually
                    });
                    // Fallback using fetchMembers mock for demo
                    if(!vm.positionList.length) vm.fetchMembers('9999'); 
                },
                searchDetail : function () {
                    var vm = this;
                    if(vm.constntNm == ''){
                        alert("검색어를 입력해주세요");
                        return;
                    }
                    comm.post({
                        url: "./searchDetailStaffList2.do",
                        params: { 'constntNm' : vm.constntNm }
                    }, function (data) {
                        vm.staffList = data.list;
                        vm.searchPerformed = true;
                    });
                },
                selectItem(index) {
                    this.selectedIndex = index;
                },
                swipeIndex : function (status){
                   // 단순화
                   if(status == "plus" && this.selectedIndex < 13) this.selectedIndex++;
                   else if(status == "minus" && this.selectedIndex > 0) this.selectedIndex--;
                   this.getIndexList(this.selectedIndex);
                },
                getIndexList : function (index){
                    var vm = this;
                    var item = vm.indexItem[index];
                    comm.post({
                        url: "./getIndexList.do",
                        params: { 'choSungIndex' : item.num }
                    }, function (data) {
                         vm.selectedIndex = index;
                        vm.indexList = data.list;
                    });
                },
                searchIndex(constntNo) {
                    var vm = this;
                    vm.constntNo = constntNo;
                    vm.activeTabIndex = 2; // 상세검색 탭으로 이동
                    vm.searchDetail(); // 검색 실행
                },
                scrollToTop() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                scrollToBottom() {
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                },
                toggleNode: function (deptCd) {
                    if (deptCd === "00000") {
                        const isActive = !this.activeNodes[deptCd];
                        this.$set(this.activeNodes, deptCd, isActive);
                        if (isActive) this.getPresidentInfo(deptCd);
                        return;
                    }
                    const isActive = !this.activeNodes[deptCd];
                    this.$set(this.activeNodes, deptCd, isActive);
                    if (isActive) {
                        this.fetchMembers(deptCd);
                    }
                },
                isActiveNode: function (nodeId) {
                    return !!this.activeNodes[nodeId];
                },
                openAllNodes() {
                    this.$set(this.activeNodes, "00000", true);
                    // 재귀적으로 모든 노드 열기 구현 필요하나 프로토타입에선 1뎁스만
                    if(this.orgDeptList) {
                        this.orgDeptList.forEach(node => {
                            this.$set(this.activeNodes, node.deptCd, true);
                        });
                    }
                },
                closeAllNodes() {
                    this.activeNodes = {};
                },
                setActiveTab(index) {
                    this.activeTabIndex = index;
                },
                getOneDeptList : function (){
                    var vm = this;
                    comm.post({ url: "./getOneDeptList.do", params: {} }, function (data) {
                        vm.oneDeptList = data.list;
                    });
                },
                getDeptList : function (lv , deptCd){
                    var vm = this;
                    if(deptCd == '') return;
                    
                    comm.post({
                        url: "./getDeptList.do",
                        params: { 'lv' : lv ,'upDeptCd' : deptCd }
                    }, function (data) {
                        if(lv == 4){
                            vm.twoDeptList = data.list;
                        }
                    });
                },
                getPresidentInfo(deptCd) {
                    var vm = this;
                    comm.post({
                        url: "./getPresidentInfo.do",
                        params: { 'ogdpDeptCd' : deptCd }
                    }, function (data) {
                        vm.president = data.info;
                    });
                },
                async fetchMembers(deptCd) {
                    var vm = this;
                    // Mock delay
                    await comm.post({
                        url: "./fetchMembers.do",
                        params: { 'ogdpDeptCd' : deptCd }
                    }, function (data) {
                        vm.updateMembers(deptCd, data.list);
                    });
                },
                updateMembers(deptCd, members) {
                    var vm = this;
                    const updateNodeMembers = (nodes) => {
                        nodes.forEach(node => {
                            if (node.deptCd === deptCd) {
                                vm.$set(node, 'members', members);
                            } else if (node.children) {
                                updateNodeMembers(node.children);
                            }
                        });
                    };
                    updateNodeMembers(vm.orgDeptList);
                },
                _mask: function (val, type) {
                    return util.maks(val, type);
                },
                _subString : function(val) {
                    return val ? val.substring(0,4) : val;
                },
                _sliceTel : function(val) {
                    return val ? (val.length > 3 ? val.slice(-4) : val) : "-";
                },
                copyEmail(email) {
                    alert("클립보드 복사(시뮬레이션): " + email);
                },
                majorPopModal(member) {
                    var vm = this;
                    if(vm.isMajorViewVisible && !member){
                        vm.isMajorViewVisible = false;
                    }else {
                        vm.isMajorViewVisible = true;
                        if(member){
                            vm.srngDetailMjrTitle = member.userDivcdNm == '교원' ? '전공분야' : '담당업무';
                            vm.srngDetailMjrNm = member.userDivcdNm == '교원' ? member.srngDetailMjrNm : member.taskFldNm;
                            vm.popModalDetailNm = member.constntNm;
                            vm.popModalDetailPosi = member.jbttlCdNm || member.userDivcdNm;
                            vm.popModalDetailDept = member.deptNm || member.ogdpDeptNm;
                        }
                    }
                },
                goProfileConfig : function() {
                    alert("설정 페이지 이동");
                },
                emptyCheck : function(value){
                    return (value === null || value === undefined || value === '' || value === ' ');
                },
            }
        });
    };

    // 실행
    $(document).ready(function(){
        documentReady();
    });
</script>
</body>
</html>
